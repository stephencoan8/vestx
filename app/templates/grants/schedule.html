{% extends "base.html" %}

{% block title %}Vesting Schedule - VestX{% endblock %}

{% block content %}
<div class="page">
    <header class="page-header">
        <h1>Complete Vesting Schedule</h1>
    </header>

    {% if vest_events %}
    <div class="table-container">
        <table class="data-table sortable-table">
            <thead>
                <tr>
                    <th data-sort="date">Vest Date</th>
                    <th data-sort="text">Grant Type</th>
                    <th data-sort="text">Share Type</th>
                    <th data-sort="number">Shares Vesting</th>
                    <th data-sort="number">Price at Vest</th>
                    <th data-sort="number">Gross Value</th>
                    <th data-sort="number">Est. Tax</th>
                    <th data-sort="number">Shares Received</th>
                    <th data-sort="number">Net Value</th>
                    <th data-sort="text">Status</th>
                </tr>
            </thead>
            <tbody>
                {% for vest in vest_events %}
                <tr class="{% if vest.has_vested %}vested-row{% endif %} clickable-row" onclick="window.location.href='{{ url_for('grants.vest_detail', vest_id=vest.id) }}';" style="cursor: pointer;" title="Click to view vest details">
                    <td>{{ vest.vest_date.strftime('%Y-%m-%d') }}</td>
                    <td><span class="badge badge-{{ vest.grant.grant_type }}">{{ vest.grant.grant_type.replace('_', ' ').title() }}</span></td>
                    <td><span class="badge badge-share">{{ vest.grant.share_type.upper() }}</span></td>
                    <td>{{ "{:,.2f}".format(vest.shares_vested) }}</td>
                    <td>${{ "{:,.2f}".format(vest.share_price_at_vest or 0) }}</td>
                    <td>${{ "{:,.2f}".format(vest.value_at_vest) }}</td>
                    <td>
                        {% if vest.has_vested %}
                            <span style="color: #333;">${{ "{:,.2f}".format(vest.tax_withheld) }}</span>
                        {% elif vest.estimated_tax %}
                            <span style="color: #f57c00;">${{ "{:,.2f}".format(vest.estimated_tax) }}*</span>
                        {% else %}
                            <span style="color: #999;">‚Äî</span>
                        {% endif %}
                    </td>
                    <td class="highlight">{{ "{:,.2f}".format(vest.shares_received) }}</td>
                    <td class="highlight">${{ "{:,.2f}".format(vest.net_value) }}</td>
                    <td>
                        {% if vest.has_vested %}
                        <span class="badge badge-success">‚úì Vested</span>
                        {% else %}
                        <span class="badge badge-pending">‚è≥ Pending</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <div style="margin-top: 1rem; padding: 0.75rem; background: #4a5568; color: white; border-left: 4px solid #f57c00; border-radius: 4px;">
        <strong>üìù Note:</strong> Taxes marked with an asterisk (*) are <em>estimated</em> for future vesting events based on your current tax profile and latest stock price. Actual taxes may vary.
    </div>
    {% else %}
    <div class="empty-state-large">
        <div class="empty-icon">üìÖ</div>
        <h2>No vesting events</h2>
        <p>Add grants to see your vesting schedule</p>
        <a href="{{ url_for('grants.add_grant') }}" class="btn btn-primary">+ Add Grant</a>
    </div>
    {% endif %}
</div>

<style>
.clickable-row {
    transition: background-color 0.2s ease, transform 0.1s ease;
}

.clickable-row:hover {
    background-color: rgba(79, 70, 229, 0.08) !important;
    transform: scale(1.002);
}

.clickable-row:active {
    transform: scale(0.998);
}

.vested-row.clickable-row:hover {
    background-color: rgba(79, 70, 229, 0.12) !important;
}
</style>
{% endblock %}
